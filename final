import SwiftUI

@main
struct YourProjectNameApp: App {
    var body: some Scene {
        WindowGroup {
            // 这里调用容器视图，它负责管理两个页面的切换
            MainView()
        }
    }
}


import SwiftUI

struct MainView: View {
    @State private var isPlayingPagePresented = false
    @State private var dragOffset: CGFloat = 0
    
    var body: some View {
        ZStack {
            // 背景层：第一个界面 (ContentView)
            ContentView()
                .scaleEffect(isPlayingPagePresented ? 0.95 : 1.0 - (dragOffset / 2000))
                .blur(radius: isPlayingPagePresented ? 10 : (dragOffset / 100))
                .animation(.spring(), value: isPlayingPagePresented)
                .animation(.interactiveSpring(), value: dragOffset)
            
            // 覆盖层：第二个界面 (PlayPage)
            if isPlayingPagePresented || dragOffset > 0 {
                PlayPage(isPresented: $isPlayingPagePresented)
                    .offset(y: isPlayingPagePresented ? 0 : -UIScreen.main.bounds.height)
                    .offset(y: dragOffset)
                    .transition(.move(edge: .top))
                    .animation(.spring(response: 0.5, dampingFraction: 0.8), value: isPlayingPagePresented)
                    .animation(.interactiveSpring(), value: dragOffset)
            }
        }
        .background(Color.black.ignoresSafeArea())
        .gesture(
            DragGesture(minimumDistance: 10)
                .onChanged { value in
                    // 仅当向下划动且页面未弹出时开始拽拉
                    if !isPlayingPagePresented && value.translation.height > 0 {
                        dragOffset = value.translation.height
                    }
                }
                .onEnded { value in
                    if value.translation.height > 150 {
                        withAnimation(.spring()) {
                            isPlayingPagePresented = true
                        }
                    }
                    withAnimation(.spring()) {
                        dragOffset = 0
                    }
                }
        )
    }
}


import SwiftUI

struct ContentView: View {
    @State private var bannerAnimate = false
    @State private var soundSectionOpacity: Double = 0
    
    var currentDateText: String {
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy年M月d日"
        return formatter.string(from: Date())
    }

    var body: some View {
        ScrollView(.vertical, showsIndicators: false) {
            VStack(spacing: 40) {
                // --- 顶部导航与 Banner ---
                VStack(spacing: 28) {
                    HStack {
                        Circle().stroke(Color.white.opacity(0.4), lineWidth: 1).frame(width: 34, height: 34)
                            .overlay(Text("logo").font(.system(size: 8)).foregroundColor(.white))
                        Text("Brand Name").font(.system(size: 20, weight: .bold)).foregroundColor(.white)
                        Spacer()
                        Image(systemName: "gift").foregroundColor(.white)
                        Image(systemName: "sparkles").padding(8).background(Circle().stroke(Color.white.opacity(0.4))).foregroundColor(.white)
                    }.padding(.horizontal)

                    ZStack(alignment: .bottomLeading) {
                        Image("image_share") // 请确保 Assets 中有此图片
                            .resizable()
                            .aspectRatio(contentMode: .fill)
                            .scaleEffect(bannerAnimate ? 1.5 : 1.0)
                            .rotationEffect(.degrees(bannerAnimate ? 15 : 0))
                            .animation(Animation.easeInOut(duration: 8.0).repeatForever(autoreverses: true), value: bannerAnimate)
                        Text("分享并邀请").font(.system(size: 22, weight: .heavy)).foregroundColor(.white).padding(.leading, 24).padding(.bottom, 30)
                    }
                    .frame(height: 200).frame(maxWidth: .infinity).clipShape(RoundedRectangle(cornerRadius: 28))
                    .glassStyle(opacity: 0.74).padding(.horizontal)
                    .onAppear { bannerAnimate = true }
                }

                // --- 场景区块 ---
                VStack(alignment: .leading, spacing: 18) {
                    HStack {
                        Text("场景").font(.system(size: 24, weight: .bold)).foregroundColor(.white)
                        Spacer()
                        Text("显示全部").foregroundColor(.gray)
                    }.padding(.horizontal)
                    
                    HStack(alignment: .top, spacing: 14) {
                        VStack(spacing: 14) {
                            SceneCard(title: "专注", imageName: "focus", height: 210, showMeteor: true)
                            SceneCard(title: "创造", imageName: "create", height: 120, titleAlignment: .bottomLeading)
                        }
                        VStack(spacing: 14) {
                            SceneCard(title: "休息", imageName: "rest", height: 100, titleAlignment: .topTrailing)
                            SceneCard(title: "冥想", imageName: "meditate", height: 190, titleAlignment: .bottomTrailing, showMeteor: true, meteorDelay: 1.0)
                        }
                    }.padding(.horizontal)
                }

                // --- 声音区块 ---
                VStack(alignment: .leading, spacing: 0) {
                    Text("声音").font(.system(size: 28, weight: .bold)).foregroundColor(.white).padding(.horizontal)
                    
                    GeometryReader { proxy in
                        let minY = proxy.frame(in: .global).minY
                        ZStack(alignment: .topTrailing) {
                            Image("face_lines").resizable().aspectRatio(contentMode: .fit).frame(width: 320).opacity(0.6).offset(x: 60, y: 100)
                            
                            VStack(alignment: .leading, spacing: 20) {
                                VStack(alignment: .leading, spacing: 8) {
                                    Text("晚上好").font(.system(size: 18)).foregroundColor(.white.opacity(0.8))
                                    Text("用户昵称").font(.system(size: 18, weight: .bold)).foregroundColor(.white)
                                        .padding(.vertical, 8).padding(.horizontal, 20).glassStyle(opacity: 0.3, cornerRadius: 12)
                                    Text("现在是\(currentDateText)夜间，一起开启好梦").font(.system(size: 14)).foregroundColor(.gray)
                                }
                                HStack(spacing: 12) {
                                    SoundBubble(title: "白噪音").offset(y: 20)
                                    SoundBubble(title: "自然之声").offset(y: 120).offset(x: 40)
                                    SoundBubble(title: "节奏").offset(y: 220).offset(x: -200)
                                }
                            }
                            .padding(.horizontal)
                        }
                        .opacity(soundSectionOpacity)
                        .onChange(of: minY) { newValue in
                            if newValue < UIScreen.main.bounds.height * 0.85 {
                                withAnimation(.easeIn(duration: 0.8)) { soundSectionOpacity = 1.0 }
                            }
                        }
                    }.frame(height: 400)
                }
            }
            .padding(.bottom, 120)
        }
        .background(Color.black.ignoresSafeArea())
    }
}

// 内部辅助组件
struct SceneCard: View {
    var title: String; var imageName: String; var height: CGFloat
    var titleAlignment: Alignment = .topLeading; var showMeteor: Bool = false; var meteorDelay: Double = 0
    var body: some View {
        ZStack(alignment: titleAlignment) {
            Image(imageName).resizable().scaledToFit().padding(12)
            Text(title).font(.system(size: 18, weight: .bold)).foregroundColor(.white).padding(16)
        }
        .frame(maxWidth: .infinity).frame(height: height)
        .glassStyle(opacity: 1.0)
    }
}

struct SoundBubble: View {
    var title: String
    var body: some View {
        Text(title).font(.system(size: 15, weight: .medium)).foregroundColor(.white)
            .frame(width: 100, height: 75)
            .glassStyle(opacity: 0.74, cornerRadius: 40, showBorder: true)
    }
}
